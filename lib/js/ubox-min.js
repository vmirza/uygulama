(function(c){var b;var a={open:function(g,f,h){g.preventDefault();c("embed, object, select").css({visibility:"hidden"});c("body").append('<div id="ubox-overlay"></div><div id="ubox"><div id="ubox-container"><div id="ubox-data"><span id="ubox-caption"></span><span id="ubox-number"></span><a id="ubox-close"></a></div><div id="ubox-media"><img id="ubox-image"/><div id="ubox-nav"><a id="ubox-prev"></a><a id="ubox-next"></a></div></div></div></div>');c(document).keydown(function(i){if(i.keyCode==27){a.close();c(document).unbind()}});c("#ubox-overlay").css({position:"absolute",top:0,opacity:h.opacity,width:c(document).width(),height:c(document).height(),"z-index":9000,background:"#000"}).fadeIn();c("#ubox").css({position:"absolute",width:"100%","z-index":10000,top:c(window).scrollTop()+(c(window).height()-c("#ubox").outerHeight(true))*0.5,left:c(window).scrollLeft(),color:h.color,"text-align":"center"}).show();c("#ubox-container").css({position:"relative",width:100,height:100,margin:"0 auto",padding:h.padding,"z-index":9000,background:h.background});c("#ubox-media").css({position:"relative",background:"url("+h.loader+") center center no-repeat"});console.log(c("#ubox-data").height());c("#ubox-nav").css({position:"absolute",top:0,left:0,width:"100%",height:"100%","z-index":1000});c("#ubox-prev, #ubox-next").css({display:"block",width:"49%",height:"100%"});c("#ubox-number, #ubox-prev").css({"float":"left"});c("#ubox-close, #ubox-next").css({"float":"right"});c("#ubox-close").css({width:20,height:20,background:"url("+h.close+") center center no-repeat"}).click(function(){a.close();return false});if(!h.outClick){c("#ubox, #ubox-overlay").click(function(){a.close();return false})}h.media.length=0;h.active=0;if(b.length==1){h.media.push(new Array(f.attr("href"),f.attr("title")))}else{for(var d=0;d<b.length;d++){h.media.push(new Array(c(b[d]).attr("href"),c(b[d]).attr("title")))}}while(h.media[h.active][0]!=f.attr("href")){h.active++}a.get(h);return false},get:function(d){c("#ubox-image,#ubox-data,#ubox-nav").hide();c("#ubox-image").load(function(){var e=c(this).width();var f=c(this).height();if(c(window).width()<e){e=c(window).width();c("#ubox-image").width(e);f=c("#ubox-image").height()}c("#ubox").css({top:c(window).height()>f?(c(window).scrollTop()+(c(window).height()-f)*0.5):c(window).scrollTop()+0,left:c(window).scrollLeft()});if(c(document).height()<f){c("#ubox-overlay").height(f)}c("#ubox-container").animate({width:e,height:f+c("#ubox-data").height()},d.speed,function(){c("#ubox-data").slideDown("fast");if(d.media[d.active][1]){c("#ubox-caption").html(d.media[d.active][1]).show()}if(d.media.length>1){c("#ubox-number").html((d.active+1)+" / "+d.media.length).show()}c("#ubox-image").fadeIn(function(){a.nav(d)})});c(this).unbind("load");if(pageTracker){pageTracker._trackEvent("ubox","loaded",d.media[d.active][1],d.media[d.active][0])}}).attr("src",d.media[d.active][0])},nav:function(d){c("#ubox-nav").show();if(d.active!=0){c("#ubox-prev").unbind().hover(function(){c(this).css({background:"url("+d.previous+") -150px 20% no-repeat"})},function(){c(this).css({background:"transparent"})}).click(function(){d.active=d.active-1;a.get(d);return false}).show()}else{c("#ubox-prev").unbind().hide()}if(d.active!=(d.media.length-1)){c("#ubox-next").unbind().hover(function(){c(this).css({background:"url("+d.next+") "+(c(this).width()-50)+"px 20% no-repeat"})},function(){c(this).css({background:"transparent"})}).click(function(){d.active=d.active+1;a.get(d);return false}).show()}else{c("#ubox-next").unbind().hide()}c(document).keydown(function(f){if(f.keyCode==37){if(d.active!=0){d.active=d.active-1;a.get(d);c(document).unbind()}}if(f.keyCode==39){if(d.active!=(d.media.length-1)){d.active=d.active+1;a.get(d);c(document).unbind()}}})},close:function(){c("#ubox").remove();c("#ubox-overlay").fadeOut(function(){c(this).remove()});c("embed, object, select").css({visibility:"visible"})}};c.fn.ubox=function(d){d=c.extend({loader:"loader.gif",previous:"ubox-sprite.png",next:"ubox-sprite.png",close:"ubox-sprite.png",color:"#333",background:"#fff",opacity:0.8,padding:5,speed:300,outClick:false,media:[],active:0},d);b=this;return this.unbind("click").click(function(f){a.open(f,c(this),d)})}})(jQuery);